import HudElement, {Hide} from "./HudElement";
import {NA, valueIsValidAssertNull} from "../consts";
import {IDriverData} from "../r3eTypes";

export default class Position extends HudElement {
    override sharedMemoryKeys: string[] = ['position', 'positionClass', 'driverData'];

    protected override render(position: number, positionClass: number, drivers: IDriverData[]): string | Hide {
        if (!valueIsValidAssertNull(position))
            return this.hide(NA);

        let myIndex = -1;
        for (let i = 0; i < drivers.length; i++) {
            if (drivers[i].place == position) {
                myIndex = i;
                break;
            }
        }

        let classCount = 0;
        for (const driver of drivers)
            if (driver != null && drivers[myIndex] != null && driver.driverInfo.classPerformanceIndex == drivers[myIndex].driverInfo.classPerformanceIndex)
                classCount++;

        return `${positionClass}/${classCount}`;
    }
}